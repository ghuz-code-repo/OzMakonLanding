<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        
        .test-form {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .result {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .error {
            background: #ffe8e8;
            color: #d00;
        }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ placeholder –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤</h1>
    
    <div class="test-form">
        <h3>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:</h3>
        <ul>
            <li><strong>+7</strong> - –†–æ—Å—Å–∏—è/–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω: +7 999 999 99 99</li>
            <li><strong>+998</strong> - –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω: +998 99 999 99 99 ‚úÖ (—Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏)</li>
            <li><strong>+996</strong> - –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω: +996 999 999 999</li>
            <li><strong>+992</strong> - –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω: +992 99 999 9999</li>
            <li><strong>+993</strong> - –¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω: +993 99 999 999</li>
        </ul>
        
        <h3>–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ placeholder:</h3>
        <ul>
            <li>–ü—Ä–∏ —Ñ–æ–∫—É—Å–µ –≤ –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ - –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥</li>
            <li>–ï—Å–ª–∏ –≤–≤–µ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –∏ —É–±—Ä–∞—Ç—å —Ñ–æ–∫—É—Å:</li>
            <li style="margin-left: 20px;">‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –∫–æ–¥ ‚Üí —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è placeholder</li>
            <li style="margin-left: 20px;">‚ùå –ù–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –∫–æ–¥ ‚Üí –ø—ã—Ç–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</li>
            <li style="margin-left: 20px;">‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–º–æ–≥–ª–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç +998</li>
            <li><strong>–¢–æ–ª—å–∫–æ –∫–æ–¥ +998 —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</strong></li>
        </ul>
        
        <input 
            type="tel" 
            id="phone" 
            placeholder="+998"
        />
        
        <button onclick="testValidation()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é</button>
        
        <div id="result" class="result">
            –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        </div>
        
        <div style="margin-top: 20px; padding: 20px; background: #fff3cd; border-radius: 5px;">
            <h3>üîç –¢–µ—Å—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤ —Å—Ç—Ä–∞–Ω</h3>
            <p>–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤ (+380, +49, +1, +86):</p>
            <div style="margin: 10px 0;">
                <button onclick="testUnknownCodeInInput('+380')">–¢–µ—Å—Ç +380 (–£–∫—Ä–∞–∏–Ω–∞)</button>
                <button onclick="testUnknownCodeInInput('+49')">–¢–µ—Å—Ç +49 (–ì–µ—Ä–º–∞–Ω–∏—è)</button>
                <button onclick="testUnknownCodeInInput('+1')">–¢–µ—Å—Ç +1 (–°–®–ê)</button>
                <button onclick="testUnknownCodeInInput('+86')">–¢–µ—Å—Ç +86 (–ö–∏—Ç–∞–π)</button>
                <button onclick="testUnknownCodeInInput('+33')">–¢–µ—Å—Ç +33 (–§—Ä–∞–Ω—Ü–∏—è)</button>
            </div>
            <div id="unknownTestResult" style="margin-top: 10px; font-family: monospace; background: white; padding: 10px; border-radius: 3px; font-size: 12px;"></div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º
        const COUNTRY_PHONE_CONFIG = {
            '7': {
                name: '–†–æ—Å—Å–∏—è/–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω',
                format: '+7 999 999 99 99', 
                maxLength: 11, // +7 + 10 —Ü–∏—Ñ—Ä
                pattern: /^7\d{10}$/
            },
            '998': {
                name: '–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω',
                format: '+998 99 999 99 99',
                maxLength: 12, // +998 + 9 —Ü–∏—Ñ—Ä  
                pattern: /^998\d{9}$/
            },
            '996': {
                name: '–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω', 
                format: '+996 999 999 999',
                maxLength: 12, // +996 + 9 —Ü–∏—Ñ—Ä
                pattern: /^996\d{9}$/
            },
            '992': {
                name: '–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω',
                format: '+992 99 999 9999', 
                maxLength: 12, // +992 + 9 —Ü–∏—Ñ—Ä
                pattern: /^992\d{9}$/
            },
            '993': {
                name: '–¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω',
                format: '+993 99 999 999',
                maxLength: 11, // +993 + 8 —Ü–∏—Ñ—Ä
                pattern: /^993\d{8}$/
            }
        };

        // –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –∏–∑ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function detectCountryCode(phone) {
            if (!phone) return null;
            
            const numbers = phone.replace(/\D/g, '');
            if (numbers.length === 0) return null;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥—ã –ø–æ –ø–æ—Ä—è–¥–∫—É —É–±—ã–≤–∞–Ω–∏—è –¥–ª–∏–Ω—ã (—á—Ç–æ–±—ã 998 –ø—Ä–æ–≤–µ—Ä–∏–ª—Å—è —Ä–∞–Ω—å—à–µ —á–µ–º 9)
            const sortedCodes = Object.keys(COUNTRY_PHONE_CONFIG).sort((a, b) => b.length - a.length);
            
            for (const code of sortedCodes) {
                if (numbers.startsWith(code)) {
                    return code;
                }
            }
            
            return null;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –†–æ—Å—Å–∏–∏/–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞ (+7)
        function formatPhoneRussia(numbers) {
            const phoneNumber = numbers.substring(1); // —É–±–∏—Ä–∞–µ–º –∫–æ–¥ 7
            let formatted = '+7';
            
            if (phoneNumber.length >= 3) {
                formatted += ' ' + phoneNumber.substring(0, 3);
            } else if (phoneNumber.length > 0) {
                formatted += ' ' + phoneNumber;
            }
            
            if (phoneNumber.length >= 6) {
                formatted += ' ' + phoneNumber.substring(3, 6);
            } else if (phoneNumber.length > 3) {
                formatted += ' ' + phoneNumber.substring(3);
            }
            
            if (phoneNumber.length >= 8) {
                formatted += ' ' + phoneNumber.substring(6, 8);
            } else if (phoneNumber.length > 6) {
                formatted += ' ' + phoneNumber.substring(6);
            }
            
            if (phoneNumber.length >= 10) {
                formatted += ' ' + phoneNumber.substring(8, 10);
            } else if (phoneNumber.length > 8) {
                formatted += ' ' + phoneNumber.substring(8);
            }
            
            return formatted;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞ (+998)
        function formatPhoneUzbekistan(numbers) {
            const phoneNumber = numbers.substring(3); // —É–±–∏—Ä–∞–µ–º –∫–æ–¥ 998
            let formatted = '+998';
            
            if (phoneNumber.length >= 2) {
                formatted += ' ' + phoneNumber.substring(0, 2);
            } else if (phoneNumber.length > 0) {
                formatted += ' ' + phoneNumber;
            }
            
            if (phoneNumber.length >= 5) {
                formatted += ' ' + phoneNumber.substring(2, 5);
            } else if (phoneNumber.length > 2) {
                formatted += ' ' + phoneNumber.substring(2);
            }
            
            if (phoneNumber.length >= 7) {
                formatted += ' ' + phoneNumber.substring(5, 7);
            } else if (phoneNumber.length > 5) {
                formatted += ' ' + phoneNumber.substring(5);
            }
            
            if (phoneNumber.length >= 9) {
                formatted += ' ' + phoneNumber.substring(7, 9);
            } else if (phoneNumber.length > 7) {
                formatted += ' ' + phoneNumber.substring(7);
            }
            
            return formatted;
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function formatPhoneNumber(value) {
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä –∏ +
            let cleaned = value.replace(/[^\d+]/g, '');
            
            // –ï—Å–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
            if (!cleaned) {
                return '';
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å +, –¥–æ–±–∞–≤–ª—è–µ–º
            if (!cleaned.startsWith('+')) {
                cleaned = '+' + cleaned;
            }
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –ø–æ—Å–ª–µ +
            const numbers = cleaned.substring(1);
            
            if (!numbers) {
                return '+';
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã
            const countryCode = detectCountryCode('+' + numbers);
            
            if (!countryCode) {
                // –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                const limitedNumbers = numbers.length > 15 ? numbers.substring(0, 15) : numbers;
                return '+' + limitedNumbers;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Å—Ç—Ä–∞–Ω—ã
            const config = COUNTRY_PHONE_CONFIG[countryCode];
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É —Å–æ–≥–ª–∞—Å–Ω–æ –º–∞–∫—Å–∏–º—É–º—É –¥–ª—è —Å—Ç—Ä–∞–Ω—ã
            const maxDigits = config.maxLength - 1; // -1 –∑–∞ –∑–Ω–∞–∫ +
            const limitedNumbers = numbers.length > maxDigits ? numbers.substring(0, maxDigits) : numbers;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
            switch (countryCode) {
                case '7':
                    return formatPhoneRussia(limitedNumbers);
                case '998':
                    return formatPhoneUzbekistan(limitedNumbers);
                default:
                    return '+' + limitedNumbers;
            }
        }

        function handlePhoneInput(value, isBlur = false) {
            if (isBlur && (!value || value.trim() === '' || value === '+')) {
                return '';
            }
            
            if (!value || value.trim() === '') {
                return '';
            }
            
            return formatPhoneNumber(value);
        }

        function handlePhoneFocus(currentValue) {
            if (!currentValue || currentValue.trim() === '') {
                return '+998';
            }
            return currentValue;
        }

        // –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∫–æ–¥—ã —Å—Ç—Ä–∞–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        const ALLOWED_COUNTRY_CODES = ['998'];
        
        // –ú–∞–ø–ø–∏–Ω–≥ ISO –∫–æ–¥–æ–≤ —Å—Ç—Ä–∞–Ω –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –∫–æ–¥—ã
        const COUNTRY_ISO_TO_PHONE_CODE = {
            'UZ': '998', // –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω
            'RU': '7',   // –†–æ—Å—Å–∏—è
            'KZ': '7',   // –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω
            'KG': '996', // –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω
            'TJ': '992', // –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω
            'TM': '993', // –¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω
        };
        
        // –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–º–æ–∫ –¥–ª—è —Ç–µ—Å—Ç–∞)
        async function getCountryByGeolocation() {
            // –°–∏–º—É–ª—è—Ü–∏—è API –≤—ã–∑–æ–≤–∞
            return new Promise((resolve) => {
                setTimeout(() => {
                    // –ú–æ–∫: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–∞–Ω—É –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                    const countries = ['UZ', 'RU', 'KG', 'TJ', 'TM'];
                    const randomCountry = countries[Math.floor(Math.random() * countries.length)];
                    console.log('–ú–æ–∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤–µ—Ä–Ω—É–ª:', randomCountry);
                    resolve(randomCountry);
                }, 500);
            });
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π placeholder
        async function getOptimalPlaceholder(currentValue) {
            // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ –∏–ª–∏ —Ç–æ–ª—å–∫–æ +, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
            if (!currentValue || currentValue.trim() === '' || currentValue === '+') {
                return '+998';
            }
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –∏–∑ –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            const detectedCode = detectCountryCode(currentValue);
            
            // –ï—Å–ª–∏ –∫–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
            if (detectedCode && ALLOWED_COUNTRY_CODES.includes(detectedCode)) {
                return '+' + detectedCode;
            }
            
            // –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
            try {
                const countryISO = await getCountryByGeolocation();
                if (countryISO) {
                    const phoneCodeByGeo = COUNTRY_ISO_TO_PHONE_CODE[countryISO];
                    
                    // –ï—Å–ª–∏ –∫–æ–¥ –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
                    if (phoneCodeByGeo && ALLOWED_COUNTRY_CODES.includes(phoneCodeByGeo)) {
                        return '+' + phoneCodeByGeo;
                    }
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error);
            }
            
            // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–æ—à–ª–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –∫–æ–¥
            return '+' + ALLOWED_COUNTRY_CODES[0];
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã
        function isOnlyCountryCode(value) {
            if (!value || value.trim() === '') return false;
            
            const cleaned = value.replace(/\s/g, ''); // —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã
            const numbers = cleaned.replace(/[^\d+]/g, ''); // –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ + –∏ —Ü–∏—Ñ—Ä—ã
            
            if (!numbers.startsWith('+')) return false;
            
            const digits = numbers.substring(1);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã
            const detectedCode = detectCountryCode(numbers);
            
            if (detectedCode) {
                // –ï—Å–ª–∏ –∫–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–ª–∏–Ω—ã
                return digits.length === detectedCode.length;
            } else {
                // –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–æ–π, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —ç—Ç–æ –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã
                // –µ—Å–ª–∏ —Ü–∏—Ñ—Ä –æ—Ç 1 –¥–æ 4 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–¥—ã —Å—Ç—Ä–∞–Ω 1-4 —Ü–∏—Ñ—Ä—ã)
                return digits.length >= 1 && digits.length <= 4;
            }
        }

        function getCountryCode(phone) {
            return detectCountryCode(phone) || '';
        }

        function validateCountryCode(phone) {
            const countryCode = getCountryCode(phone);
            const isAllowed = ALLOWED_COUNTRY_CODES.includes(countryCode);
            
            return {
                isValid: isAllowed,
                countryCode: countryCode,
                allowedCodes: ALLOWED_COUNTRY_CODES
            };
        }

        function validatePhoneComplete(phone) {
            if (!phone) return false;
            
            const numbers = phone.replace(/\D/g, '');
            
            if (numbers.length < 10 || numbers.length > 15) return false;
            
            return validateCountryCode(phone).isValid;
        }

        function testValidation() {
            const phoneInput = document.getElementById('phone');
            const phone = phoneInput.value;
            const result = document.getElementById('result');
            
            const countryValidation = validateCountryCode(phone);
            const isComplete = validatePhoneComplete(phone);
            const detectedCode = detectCountryCode(phone);
            const countryInfo = detectedCode ? COUNTRY_PHONE_CONFIG[detectedCode] : null;
            
            let message = `<strong>–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:</strong><br>`;
            message += `–ù–æ–º–µ—Ä: "${phone}"<br>`;
            message += `–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∞: ${countryInfo ? countryInfo.name : '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}<br>`;
            message += `–ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã: ${countryValidation.countryCode}<br>`;
            message += `–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: ${countryInfo ? countryInfo.format : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>`;
            message += `–ö–æ–¥ —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏: ${countryValidation.isValid ? '‚úÖ' : '‚ùå'}<br>`;
            message += `–ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è: ${isComplete ? '‚úÖ' : '‚ùå'}<br>`;
            
            if (!countryValidation.isValid && countryValidation.countryCode) {
                const allowedCodesText = countryValidation.allowedCodes.map(code => `+${code}`).join(', ');
                message += `<span style="color: red;">–û—à–∏–±–∫–∞: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–æ–º–µ—Ä–∞ —Å –∫–æ–¥–∞–º–∏: ${allowedCodesText}</span>`;
            }
            
            result.innerHTML = message;
            result.className = isComplete ? 'result' : 'result error';
        }

        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        const phoneInput = document.getElementById('phone');
        const result = document.getElementById('result');

        phoneInput.addEventListener('input', (e) => {
            const formatted = handlePhoneInput(e.target.value);
            e.target.value = formatted;
            
            const detectedCode = detectCountryCode(formatted);
            const countryInfo = detectedCode ? COUNTRY_PHONE_CONFIG[detectedCode] : null;
            
            result.innerHTML = `
                <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> "${formatted}"<br>
                <strong>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∞:</strong> ${countryInfo ? countryInfo.name : '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}<br>
                <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:</strong> ${countryInfo ? countryInfo.format : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                <strong>–î–ª–∏–Ω–∞:</strong> ${formatted.length} —Å–∏–º–≤–æ–ª–æ–≤<br>
                <strong>–¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã:</strong> ${formatted.replace(/\D/g, '')}
            `;
            result.className = 'result';
        });

        phoneInput.addEventListener('focus', async (e) => {
            const valueWithPrefix = handlePhoneFocus(e.target.value);
            if (valueWithPrefix !== e.target.value) {
                e.target.value = valueWithPrefix;
                result.innerHTML = `<strong>–§–æ–∫—É—Å:</strong> –î–æ–±–∞–≤–ª–µ–Ω –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å`;
            }
        });

        phoneInput.addEventListener('blur', async (e) => {
            const currentValue = e.target.value;
            
            // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ –∏–ª–∏ —Ç–æ–ª—å–∫–æ +, –æ—á–∏—â–∞–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º placeholder
            if (!currentValue || currentValue.trim() === '' || currentValue === '+') {
                const optimalPlaceholder = await getOptimalPlaceholder('');
                e.target.placeholder = optimalPlaceholder;
                e.target.value = '';
                result.innerHTML = `<strong>–ü–æ—Ç–µ—Ä—è —Ñ–æ–∫—É—Å–∞:</strong> –ü–æ–ª–µ –æ—á–∏—â–µ–Ω–æ, placeholder —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${optimalPlaceholder}`;
                return;
            }
            
            // –ï—Å–ª–∏ –≤ –ø–æ–ª–µ —Ç–æ–ª—å–∫–æ –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã
            if (isOnlyCountryCode(currentValue)) {
                const optimalPlaceholder = await getOptimalPlaceholder(currentValue);
                e.target.placeholder = optimalPlaceholder;
                e.target.value = '';
                result.innerHTML = `<strong>–ü–æ—Ç–µ—Ä—è —Ñ–æ–∫—É—Å–∞:</strong> –û–±–Ω–∞—Ä—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã. Placeholder: ${optimalPlaceholder}`;
                return;
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
            result.innerHTML = `<strong>–ü–æ—Ç–µ—Ä—è —Ñ–æ–∫—É—Å–∞:</strong> –°–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–æ–º–µ—Ä: "${currentValue}"`;
        });

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
        console.log('=== –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –¥–ª—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã placeholder ===');
        console.log('–¢–µ—Å—Ç isOnlyCountryCode:');
        console.log('"+7" ->', isOnlyCountryCode('+7'));
        console.log('"+998" ->', isOnlyCountryCode('+998'));
        console.log('"+7999" ->', isOnlyCountryCode('+7999'));
        
        console.log('\n=== –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ ===');
        console.log('–†–æ—Å—Å–∏—è (+7):');
        console.log('"+79991234567" ->', formatPhoneNumber('+79991234567'));
        
        console.log('\n–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω (+998):');
        console.log('"+998901234567" ->', formatPhoneNumber('+998901234567'));
        
        console.log('\n–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω (+996):');
        console.log('"+996555123456" ->', formatPhoneNumber('+996555123456'));
        
        // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ placeholder
        console.log('\n=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ placeholder ===');
        console.log('–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:');
        console.log('1. –ö–ª–∏–∫–Ω–∏—Ç–µ –≤ –ø–æ–ª–µ - –ø–æ—è–≤–∏—Ç—Å—è +998');
        console.log('2. –°–æ—Ç—Ä–∏—Ç–µ –∏ –≤–≤–µ–¥–∏—Ç–µ +7, –∫–ª–∏–∫–Ω–∏—Ç–µ –≤–Ω–µ –ø–æ–ª—è');
        console.log('3. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π placeholder');
        console.log('4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ +996, +992, +993');
        console.log('5. –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä - –æ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è');
        
        // –¢–µ—Å—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤ —Å—Ç—Ä–∞–Ω
        console.log('\n=== –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤ ===');
        
        function testUnknownCountryCode(code) {
            console.log(`\n–¢–µ—Å—Ç –∫–æ–¥–∞ ${code}:`);
            console.log('isOnlyCountryCode:', isOnlyCountryCode(code));
            console.log('detectCountryCode:', detectCountryCode(code));
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –∫–æ–¥–∞
            if (isOnlyCountryCode(code)) {
                console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç —ç—Ç–æ –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã');
                console.log('üîÑ –ü–æ–ª–µ –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–æ –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π placeholder');
            } else {
                console.log('‚ùå –°–∏—Å—Ç–µ–º–∞ –ù–ï —Å—á–∏—Ç–∞–µ—Ç —ç—Ç–æ –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã');
            }
        }
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–¥—ã
        testUnknownCountryCode('+380'); // –£–∫—Ä–∞–∏–Ω–∞
        testUnknownCountryCode('+49');  // –ì–µ—Ä–º–∞–Ω–∏—è
        testUnknownCountryCode('+1');   // –°–®–ê/–ö–∞–Ω–∞–¥–∞
        testUnknownCountryCode('+86');  // –ö–∏—Ç–∞–π
        testUnknownCountryCode('+33');  // –§—Ä–∞–Ω—Ü–∏—è
        testUnknownCountryCode('+44');  // –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
        testUnknownCountryCode('+12345'); // –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π –∫–æ–¥
        testUnknownCountryCode('+9');      // –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤
        function testUnknownCodeInInput(code) {
            const phoneInput = document.getElementById('phone');
            const resultDiv = document.getElementById('unknownTestResult');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥ –≤ –ø–æ–ª–µ
            phoneInput.value = code;
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º blur —Å–æ–±—ã—Ç–∏–µ
            const isOnlyCode = isOnlyCountryCode(code);
            const detectedCode = detectCountryCode(code);
            
            let result = `<strong>–¢–µ—Å—Ç –∫–æ–¥–∞ ${code}:</strong><br>`;
            result += `‚Ä¢ isOnlyCountryCode: ${isOnlyCode}<br>`;
            result += `‚Ä¢ detectCountryCode: ${detectedCode || 'null'}<br>`;
            
            if (isOnlyCode) {
                result += `‚Ä¢ ‚úÖ –°—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã<br>`;
                result += `‚Ä¢ üîÑ –ü–æ–ª–µ –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–æ –ø—Ä–∏ blur<br>`;
                result += `‚Ä¢ üìç Placeholder —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é<br>`;
                
                // –°–∏–º—É–ª–∏—Ä—É–µ–º –æ—á–∏—Å—Ç–∫—É –ø–æ–ª—è
                phoneInput.value = '';
                phoneInput.placeholder = '–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...';
                
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
                setTimeout(() => {
                    phoneInput.placeholder = '+998 99 999 99 99';
                    result += `‚Ä¢ ‚ú® Placeholder –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ +998<br>`;
                    resultDiv.innerHTML = result;
                }, 500);
            } else {
                result += `‚Ä¢ ‚ùå –ù–ï —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã<br>`;
                result += `‚Ä¢ ‚è∏Ô∏è –ü–æ–ª–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π<br>`;
            }
            
            resultDiv.innerHTML = result;
        }
    </script>
</body>
</html>
